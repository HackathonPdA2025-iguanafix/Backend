### ========================================
### TESTES DA API - SISTEMA DE CADASTRO
### ========================================
### Use Ctrl+Alt+R (Windows) ou Cmd+Alt+R (Mac) para executar
### Ou clique em "Send Request" acima de cada requisição

@baseUrl = http://localhost:3001
@token = seu_token_aqui

### ========================================
### 1. AUTENTICAÇÃO
### ========================================

### 1.1 Registrar novo usuário (Formulário Inicial)
POST {{baseUrl}}/auth/register
Content-Type: application/json

{
  "nome": "João Silva",
  "email": "joao.silva@example.com",
  "cpf": "12345678901",
  "senha": "senha123"
}

### 1.2 Login
# @name login
POST {{baseUrl}}/auth/login
Content-Type: application/json

{
  "email": "joao.silva@example.com",
  "senha": "senha123"
}

### 1.3 Verificar dados do usuário autenticado
GET {{baseUrl}}/auth/me
Authorization: Bearer {{token}}

### ========================================
### 2. CHATBOT (requer autenticação)
### ========================================

### 2.1 Iniciar conversa com chatbot
POST {{baseUrl}}/chatbot/chat
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "message": "Olá! Quero completar meu cadastro"
}

### 2.2 Enviar informação - RG
POST {{baseUrl}}/chatbot/chat
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "message": "Meu RG é 123456789"
}

### 2.3 Enviar informação - Endereço
POST {{baseUrl}}/chatbot/chat
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "message": "Moro em São Paulo, SP, CEP 01310-100"
}

### 2.4 Enviar informação - Categoria de serviço
POST {{baseUrl}}/chatbot/chat
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "message": "Sou eletricista e encanador"
}

### 2.5 Perguntar sobre documento
POST {{baseUrl}}/chatbot/chat
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "message": "O que é certidão de antecedentes criminais?"
}

### 2.6 Validar campo específico - CPF
POST {{baseUrl}}/chatbot/validate-field
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "fieldName": "cpf",
  "value": "123.456.789-01"
}

### 2.7 Validar campo específico - CEP
POST {{baseUrl}}/chatbot/validate-field
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "fieldName": "cep",
  "value": "01310-100"
}

### 2.8 Validar campo específico - CNPJ
POST {{baseUrl}}/chatbot/validate-field
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "fieldName": "cnpj",
  "value": "12.345.678/0001-90"
}

### 2.9 Atualizar dados do provider diretamente
POST {{baseUrl}}/chatbot/update-data
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "rg": "123456789",
  "estado": "SP",
  "cidade": "São Paulo",
  "cep": "01310100",
  "bairro": "Bela Vista",
  "logradouro": "Avenida Paulista",
  "numero": "1000",
  "estadoInteresse": "SP",
  "cidadeInteresse": "São Paulo",
  "categorias": "[\"eletricista\", \"encanador\"]"
}

### 2.10 Obter histórico da conversa
GET {{baseUrl}}/chatbot/history
Authorization: Bearer {{token}}

### 2.11 Resetar conversa
POST {{baseUrl}}/chatbot/reset
Authorization: Bearer {{token}}

### ========================================
### 3. UPLOAD DE ARQUIVOS (requer autenticação)
### ========================================

### 3.1 Upload de arquivo único
# NOTA: Substitua o caminho pelo arquivo real
POST {{baseUrl}}/upload/single
Authorization: Bearer {{token}}
Content-Type: multipart/form-data; boundary=----WebKitFormBoundary7MA4YWxkTrZu0gW

------WebKitFormBoundary7MA4YWxkTrZu0gW
Content-Disposition: form-data; name="file"; filename="documento.pdf"
Content-Type: application/pdf

< ./test-files/documento.pdf
------WebKitFormBoundary7MA4YWxkTrZu0gW--

### 3.2 Upload de múltiplos arquivos
# NOTA: Substitua os caminhos pelos arquivos reais
POST {{baseUrl}}/upload/multiple
Authorization: Bearer {{token}}
Content-Type: multipart/form-data; boundary=----WebKitFormBoundary7MA4YWxkTrZu0gW

------WebKitFormBoundary7MA4YWxkTrZu0gW
Content-Disposition: form-data; name="files"; filename="foto1.jpg"
Content-Type: image/jpeg

< ./test-files/foto1.jpg
------WebKitFormBoundary7MA4YWxkTrZu0gW
Content-Disposition: form-data; name="files"; filename="foto2.jpg"
Content-Type: image/jpeg

< ./test-files/foto2.jpg
------WebKitFormBoundary7MA4YWxkTrZu0gW--

### ========================================
### 4. PROVIDERS (listagem e detalhes)
### ========================================

### 4.1 Listar todos os providers
GET {{baseUrl}}/providers

### 4.2 Buscar provider por ID
# Substitua {id} pelo ID real do provider
GET {{baseUrl}}/providers/clv0x1x2x3x4x5x6x7x8x9

### ========================================
### EXEMPLOS DE FLUXO COMPLETO
### ========================================

### FLUXO 1: Cadastro Completo do Zero

# Passo 1: Registrar
POST {{baseUrl}}/auth/register
Content-Type: application/json

{
  "nome": "Maria Santos",
  "email": "maria.santos@example.com",
  "cpf": "98765432100",
  "senha": "senha456"
}

###

# Passo 2: Login para pegar o token
# @name loginFluxo
POST {{baseUrl}}/auth/login
Content-Type: application/json

{
  "email": "maria.santos@example.com",
  "senha": "senha456"
}

###

# Passo 3: Usar o token para conversar com chatbot
# Copie o token da resposta acima e cole em @token no topo do arquivo
POST {{baseUrl}}/chatbot/chat
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "message": "Olá! Estou pronta para completar meu cadastro"
}

###

# Passo 4: Continuar respondendo às perguntas do chatbot
POST {{baseUrl}}/chatbot/chat
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "message": "Meu RG é 987654321, moro em Rio de Janeiro, RJ, CEP 20040-020, Bairro Centro, Rua da Assembleia, número 10"
}

### ========================================
### TESTES DE VALIDAÇÃO
### ========================================

### Teste 1: Registrar com email inválido (deve falhar)
POST {{baseUrl}}/auth/register
Content-Type: application/json

{
  "nome": "Teste",
  "email": "email-invalido",
  "cpf": "12345678901",
  "senha": "senha123"
}

###

### Teste 2: Registrar com CPF inválido (deve falhar)
POST {{baseUrl}}/auth/register
Content-Type: application/json

{
  "nome": "Teste",
  "email": "teste@example.com",
  "cpf": "123",
  "senha": "senha123"
}

###

### Teste 3: Registrar com senha curta (deve falhar)
POST {{baseUrl}}/auth/register
Content-Type: application/json

{
  "nome": "Teste",
  "email": "teste@example.com",
  "cpf": "12345678901",
  "senha": "123"
}

###

### Teste 4: Login com credenciais inválidas (deve falhar)
POST {{baseUrl}}/auth/login
Content-Type: application/json

{
  "email": "naoexiste@example.com",
  "senha": "senhaerrada"
}

###

### Teste 5: Acessar endpoint protegido sem token (deve falhar)
GET {{baseUrl}}/chatbot/chat

###

### Teste 6: Chatbot com mensagem vazia (deve retornar erro amigável)
POST {{baseUrl}}/chatbot/chat
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "message": ""
}

### ========================================
### DICAS DE USO
### ========================================
# 1. Clique em "Send Request" acima de cada requisição para executar
# 2. Após fazer login, copie o token da resposta e cole na variável @token no topo
# 3. Para upload de arquivos, crie uma pasta "test-files" com arquivos de teste
# 4. Use Ctrl+Alt+R para executar a requisição onde está o cursor
# 5. As respostas aparecem em uma aba separada à direita
